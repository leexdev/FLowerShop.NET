@model FLowerShop.Models.SearchModel

<div id="filteredProducts">
    <div class="list-product row justify-content-center">
        @foreach (var item in Model.Flowers)
        {
            <div class="item-product col-md-3 col-6 mb-4">
                <div class="image position-relative mb-3">
                    <a href="@Url.Action("Detail", "Flowers", new { flowerId = item.FLOWER_ID })">
                        <img class="img-fluid" src="~/Content/assets/img/@item.FLOWER_IMAGE" alt="@item.FLOWER_IMAGE">
                        @if (item.OLD_PRICE != null)
                        {
                            var oldPrice = item.OLD_PRICE;
                            var newPrice = item.NEW_PRICE;
                            var discount = ((oldPrice - newPrice) / oldPrice) * 100;
                            <span class="percent-off-rounded">@discount.Value.ToString("N0")%<br>GIẢM</span>
                        }
                    </a>
                </div>
                <div class="content">
                    <div class="description">
                        <div class="fw-bold text-center">
                            <a href="@Url.Action("Detail", "FLowers", new { flowerId = item.FLOWER_ID })">@item.FLOWER_NAME</a>
                        </div>
                        <div class="price text-center fw-bold p-2">
                            <span class="price-new">@item.NEW_PRICE.Value.ToString("N0")VND</span>
                            @if (item.OLD_PRICE != null)
                            {
                                <span class="price-old">@item.OLD_PRICE.Value.ToString("N0")VND</span>
                            }
                        </div>
                        <div class="d-flex justify-content-center">
                            <a class="btn bg-pink px-md-4 text-white rounded" href="@Url.Action("Detail", "FLowers", new { flowerId = item.FLOWER_ID })">Đặt hàng</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
    
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var filterSelect = document.getElementById("filterSelect");
        var searchQuery = document.getElementById("search-flower-name");
        var flowerTypeId = document.getElementById("flowerTypeId");
        var filteredProducts = document.getElementById("filteredProducts");

        filterSelect.addEventListener("change", function () {
            var selectedValue = filterSelect.value;
            var searchQueryValue = searchQuery.value;
            var flowerTypeIdValue = flowerTypeId.value

            var xhr = new XMLHttpRequest();
            xhr.open("GET", `/Flowers/FilterFLowers?filterValue=${selectedValue}&searchQuery=${searchQueryValue}&flowerTypeId=${flowerTypeIdValue}`, true);
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onload = function () {
                if (xhr.status === 200) {
                    filteredProducts.innerHTML = xhr.responseText;
                } else {
                    console.error("Lỗi:", xhr.statusText);
                }
            };

            xhr.send();
        });
    });

</script>